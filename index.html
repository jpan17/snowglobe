<!DOCTYPE html>
<html lang="en">
	<head>
		<title>SNOW GLOBE</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico">
	</head>

<body>

		<div class="wrapper">
			<div id="container"></div>
    </div>
    <script src="libjs/three.min.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
    <script src="https://r105.threejsfundamentals.org/threejs/resources/threejs/r105/three.min.js"></script>
		<script src="libjs/OrbitControl.js"></script>
    <script src="libjs/dat.gui.min.js"></script>
    <script src="js/STLLoader.js"></script>
    <!-- ---------------- CUSTOM SHADER CODE ------------------------ -->
    <script id="vertexShader" type="x-shader/x-vertex">

      uniform vec3 viewVector;
      uniform float c;
      uniform float p;
      varying float intensity;
      void main()
      {
          vec3 vNormal = normalize( normalMatrix * normal );
        vec3 vNormel = normalize( normalMatrix * viewVector );
        intensity = pow( c - dot(vNormal, vNormel), p );

          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
      }

    </script>

    <script id="fragmentShader" type="x-shader/x-vertex">
      #define TAU 6.2831853071

      void mainImage(out vec4 fragColor, in vec2 fragCoord) {
        vec2 uv = fragCoord.xy / iResolution.xy;
          
          float o = texture(iChannel1, uv * 0.25 + vec2(0.0, iTime * 0.025)).r;
          float d = (texture(iChannel0, uv * 0.25 - vec2(0.0, iTime * 0.02 + o * 0.02)).r * 2.0 - 1.0);
          
          float v = uv.y + d * 0.1;
          v = 1.0 - abs(v * 2.0 - 1.0);
          v = pow(v, 2.0 + sin((iTime * 0.2 + d * 0.25) * TAU) * 0.5);
          
          vec3 color = vec3(0.0);
          
          float x = (1.0 - uv.x * 0.75);
          float y = 1.0 - abs(uv.y * 2.0 - 1.0);
          color += vec3(x * 0.5, y, x) * v;
          
          vec2 seed = fragCoord.xy;
          vec2 r;
          r.x = fract(sin((seed.x * 12.9898) + (seed.y * 78.2330)) * 43758.5453);
          r.y = fract(sin((seed.x * 53.7842) + (seed.y * 47.5134)) * 43758.5453);

          float s = mix(r.x, (sin((iTime * 2.5 + 60.0) * r.y) * 0.5 + 0.5) * ((r.y * r.y) * (r.y * r.y)), 0.04); 
          color += pow(s, 70.0) * (1.0 - v);
          
          fragColor.rgb = color;
          fragColor.a = 1.0;
      }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/103/three.min.js"></script>
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simplex-noise/2.4.0/simplex-noise.min.js"></script>

    <!-- END OF SHADER CODE -->
    <div id="alert_div" title="alert"> </div>
    <script src="https://threejs.org/examples/js/controls/PointerLockControls.js"></script>
    <script src="js/scene/Evergreen.js" type="text/javascript"> </script>
		<script src="js/scene/Background.js" type="text/javascript"> </script>
    <script src="js/PlayerControls.js" type="text/javascript"> </script>
    <script src="js/scene.js" type="text/javascript"> </script>

</body>
